@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}
<br />
<input type="hidden" id="txtd"><input type="hidden" id="txte">
<!--<input type="radio" name="gender" value="male" checked> Ida & Volta
<input type="radio" name="gender" value="female"> Ida ou volta<br />-->
origem: <input type="text" id="txt" placeholder="cidade,aeroporto ou sigla" />  destino: <input type="text" id="txtEndereco" placeholder="cidade,aeroporto ou sigla" /><br />
periodo: <input id="letsgo" type="text" />  <br />
<input value="procurar" type="button" onclick="pass()" />


<script type="text/javascript" src="~/lib/jquery/dist/jquery.min.js"></script>
<link rel="stylesheet" type="text/css" href="~/lib/datatables.min.css">
<script type="text/javascript" src="~/lib/datatables.min.js"></script><!---->
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
        integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
        crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="~/js/jquery.mask.min.js"></script>
<script type="text/javascript">
    $("#txtEndereco").val('');
    $("#txt").val('');
    $("#letsgo").val('');
    function b64EncodeUnicode(str) {
        // first we use encodeURIComponent to get percent-encoded UTF-8,
        // then we convert the percent encodings into raw bytes which
        // can be fed into btoa.
        return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,
            function toSolidBytes(match, p1) {
                return String.fromCharCode('0x' + p1);
            }));
    }
    class aeroporto {
        constructor(id, sigla, nome) {
            this.id = id;
            this.sigla = sigla;
            this.nome = nome;
        }
    }
    var adidas = [];
    var korn = [];
    var search = '';
    //$('input[id="letsgo"]').daterangepicker();
    function pass() {
        //alert('ADSF');
        window.location.href = "./voo?partida=" + $("#txtd").val() + "&chegada=" + $("#txte").val() + "&date=" + b64EncodeUnicode($("#letsgo").val());;
    }
    $('#letsgo').mask('00/00/0000');
    $.ajax({
        type: "GET",
        url: '/api/devil/aeroporto',
        timeout: 30000,
        contentType: "application/json; charset=utf-8",
        cache: false,
        error: function () {
            console.log("erro");
        },
        success: function (devil) {
            //var ii = 1;
            console.log(" asdfasdfasdfasdf");
            //alert('a')
            $.each(JSON.parse(devil), function (i, cliente) {

                //alert(cliente.Nome);

                adidas.push(new aeroporto(cliente.ID, cliente.sigla, cliente.Nome));
            });
            //alert(adidas.length);

        }
    });
    function logArrayElements(element, index, array) {
        if (element.nome.toLowerCase().includes(search.toLowerCase()))
            korn.push(element);
    }
    $("#txt").autocomplete({
        source: function (request, response) {
            search = request.term;
            korn = [];
            adidas.forEach(logArrayElements);
            response($.map(korn, function (value, key) {
                return {
                    label: value.nome,
                    value: value.id.toString()
                }
            }));
        },
        focus: function (event, ui) {
            $("#txtd").val(ui.item.value);
            return false;
        },
        select: function (event, ui) {
            //alert(ui.item.id);
            $(this).val(ui.item.label);
            $("#txtd").val(ui.item.value);
            return false;
        }
    });

    $("#txtEndereco").autocomplete({
        source: function (request, response) {
            search = request.term;
            korn = [];
            adidas.forEach(logArrayElements);
            //alert(request.term);
            response($.map(korn, function (value, key) {
                return {
                    label: value.nome,
                    value: value.id.toString()
                }
            }));
        },
        focus: function (event, ui) {
            $("#txte").val(ui.item.value);
            return false;
        },
        select: function (event, ui) {
            //alert(ui.item.id);
            $(this).val(ui.item.label);
            $("#txte").val(ui.item.value);
            return false;
        }
    });

</script>